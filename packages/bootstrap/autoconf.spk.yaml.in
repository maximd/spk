# use a low version and explicit bootstrap tag to be clear
pkg: autoconf/VERSION+bootstrap.1
api: v1alpha1/recipe
meta:
  description: |
    This is an empty package which copies an already installed version
    of autoconf from the current system. It should not be published
    or used outside of getting the package build process going

source:
  collect: [] # no source package files

options:
  - var: arch
  - var: os
  - var: distro
  - var: centos
  - pkg: stdfs
  - var: autoconf.bootstrapped=yes
    atDownstream: true

build:
  script: |
    if ! rpm -q autoconf; then
      echo "autoconf is not installed on this system"
      exit 1
    fi
    files="$(rpm -ql autoconf | grep -v /doc/)"
    mkdir -p /spfs/share/aclocal
    for file in $files; do
      [ -f $file ] || continue
      newfile=/spfs/${file/\/usr\//}
      mkdir -p $(dirname $newfile)
      cp $file $newfile
    done


install:
  environment:
    - set: ACLOCAL_PATH
      value: /spfs/share/aclocal
  requirements:
    - pkg: stdfs
