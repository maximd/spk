pkg: glibc/2.33

sources:
  - tar: http://ftpmirror.gnu.org/gnu/glibc/glibc-2.33.tar.gz

build:
  options:
    - var: bootstrap
      static: yes
    - var: target/x86_64-pc-linux-gnu
    - pkg: gcc
    - pkg: stdfs
    - pkg: coreutils
    - pkg: binutils
      inheritance: Strong
  script:
    - cd glibc-2.33
    - mkdir build; cd build
    - unset LD_LIBRARY_PATH LIBRARY_PATH
    - ../configure
      --with-binutils=/spfs
      --prefix=/spfs
      --host=$SPK_OPT_target
      --build=$(../scripts/config.guess)
      --enable-kernel=3.2
      libc_cv_slibdir=/lib
    - exit 1
    - make -j$(nproc)
    - make DESTDIR=/spfs install

tests:
  - stage: install
    requirements:
      - pkg: gcc
    script:
      - echo 'int main(){}' > dummy.c
      - $CC dummy.c
      - readelf -l a.out | grep '/ld-linux'

install:
  requirements:
    - pkg: stdfs
    - pkg: binutils
      fromBuildEnv: x.x
