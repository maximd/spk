# use a low version and explicit bootstrap tag to be clear
pkg: perl/0.0.0+bootstrap.1

sources: [] # no source package files

build:
  # this is an empty package which just assumes that perl is installed and
  # available to be used, hence the bootstrapping idea...
  # Usually this package is only used to satisfy the dependencies of the
  # real perl package which requires itself to build itself
  options:
    - var: arch
    - var: os
    - var: distro
    - var: centos
    - pkg: stdfs
    - var: bootstrapped/yes
      inheritance: Strong
  script: |
    if ! rpm -q perl; then
      echo "perl is not installed on this system"
      exit 1
    fi
    files="$(rpm -ql perl | grep -v /doc/)"
    mkdir -p /spfs/share/aclocal
    for file in $files; do
      [ -f $file ] || continue
      newfile=/spfs/${file/\/usr\//}
      mkdir -p $(dirname $newfile)
      cp $file $newfile
    done
    mkdir -p /spfs/etc/startup.d/
    echo "export PERL5LIB=/spfs/lib/perl5" > /spfs/etc/spfs/startup.d/activate-perl.sh
    echo "setenv PERL5LIB /spfs/lib/perl5" > /spfs/etc/spfs/startup.d/activate-perl.csh

install:
  requirements:
    - pkg: stdfs

install:
  requirements:
    - pkg: stdfs
