pkg: NAME/VERSION+bootstrap.1
api: v1alpha1/recipe
meta:
  description: |
    This is an package which is a relocated copy of the system package
    of the same name, hence the bootstrapping idea... The files in this
    package may not actually be used at runtime and may also not work when
    relocated but if the original package is still installed on the host
    then there should not be too much issue. THESE BOOTSTRAP PACKAGES SHOULD
    NOT BE PUBLISHED OR SHARED.

source:
  collect: [] # no source package files

options:
  - var: arch
  - var: os
  - var: distro
  - var: centos
  - pkg: stdfs
  - var: NAME.bootstrapped=yes
    atDownstream: true

build:
  script: |
    if ! rpm -q NAME; then
      echo "NAME is not installed on this system"
      exit 1
    fi
    files="$(rpm -ql NAME | grep -v /doc/ | grep -v /lib/ || : )"
    mkdir -p /spfs/share/aclocal
    for file in $files; do
      [ -f $file ] || continue
      newfile=/spfs/${file/\/usr\//}
      mkdir -p $(dirname $newfile)
      if [ -L $file ]; then
        target=$(readlink $file)
        newtarget=${target/\/usr/\/spfs}
        ln -s $newtarget $newfile
      else
        cp $file $newfile
      fi
    done
    [ ! -e /spfs/share/info ] || rm -r /spfs/share/info
